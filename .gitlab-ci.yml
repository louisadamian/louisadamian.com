image: node:14.17.0

include:
  - template: Dependency-Scanning.gitlab-ci.yml
  - template: Security/SAST.gitlab-ci.yml
  - template: DAST.gitlab-ci.yml


stages:
  - dev
  - test
  - deploy
  - dast


dast:
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
  stage: dast
  dast_configuration:
    site_profile: "louisadamian.com"
    scanner_profile: "main_scanner"


variables:
      SECURE_LOG_LEVEL: error

pages:
  stage: deploy
  cache:
    paths:
    - node_modules/
  script:
  - yarn install
  - yarn build
  artifacts:
    paths:
    - public
  rules:
      - if: $CI_COMMIT_BRANCH == "master"